// Liderin süreyi yönettiği fonksiyon (Firebase yükünü azaltıyoruz)
async function runPhase(name, sec) {
    // Firebase'e sadece sürenin KAÇTAN başlayacağını bir kere yazıyoruz
    update(ref(db, `rooms/${currentRoom}`), { 
        phase: name, 
        timer: sec,
        startTime: Date.now() // Başlangıç zaman damgasını ekle
    });
}

// Oyuncuların ekranındaki takılmayı önleyen akıcı sayaç fonksiyonu
function handleGameFlow(data) {
    const timerText = document.getElementById('timerDisplay');
    
    // Firebase'den gelen saniyeyi doğrudan kullanmak yerine yerel hesaplama yapıyoruz
    let timeLeft = data.timer;
    
    // Eğer bir saniye sayacı zaten varsa temizle (üst üste binmesin)
    if (window.localInterval) clearInterval(window.localInterval);

    window.localInterval = setInterval(() => {
        if (timeLeft <= 0) {
            clearInterval(window.localInterval);
            return;
        }
        timeLeft--;
        
        // Ekranı güncelle (Kasmadan akar)
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        timerText.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }, 1000);

    // ... (Diğer faz işlemleri/butonlar aynı kalıyor)
}
